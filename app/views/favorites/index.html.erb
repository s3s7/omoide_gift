<%# encoding: utf-8 %>
<% content_for(:title, "お気に入り一覧") %>

<!-- メインコンテナ - 中央寄せ -->
<div class="gift-records-container">
<!-- ヘッダー部分 -->
<div class="gift-records-header">
  <h2 class="text-2xl font-bold text-gray-800 mb-4">
    <i class="fas fa-heart mr-2 text-green-600"></i>
    お気に入り一覧
  </h2>
  
  <!-- ナビゲーション -->
  <div class="flex justify-center space-x-3">
    <%= link_to mypage_path,
        class: "inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary" do %>
      <i class="fas fa-arrow-left mr-2"></i>
      マイページに戻る
    <% end %>
    
    <%= link_to gift_records_path,
        class: "inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white btn-primary hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary" do %>
      <i class="fas fa-gift mr-2"></i>
      ギフト記録一覧
    <% end %>
  </div>
</div>

<!-- お気に入り統計 -->
<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6 max-w-2xl mx-auto">
  <div class="text-center">
    <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
      <i class="fas fa-heart text-2xl text-green-600"></i>
    </div>
    <h3 class="text-lg font-medium text-gray-800 mb-2">お気に入り登録数</h3>
    <p class="text-3xl font-bold text-green-600"><%= @total_favorites %>件</p>
    <p class="text-sm text-gray-600 mt-2">あなたがお気に入りに登録したギフト記録です</p>
  </div>
</div>

<!-- お気に入り一覧 -->
<% if @favorites.any? %>
  <div class="gift-records-grid">
    <% @favorites.each do |favorite| %>
      <% gift_record = favorite.gift_record %>
      <% next unless gift_record.present? %>
      
      <div class="gift-card-container gift-record-card bg-white rounded-lg shadow-md overflow-hidden transition-all duration-300 transform hover:shadow-xl hover:-translate-y-2" onclick="Turbo.visit('<%= gift_record_path(gift_record, origin: 'favorites') %>')" style="cursor: pointer;">
        <div class="gift-card-image relative overflow-hidden">
          <a href="<%= gift_record_path(gift_record, origin: 'favorites') %>"
             class="absolute inset-0 z-[4]"
             onclick="event.stopPropagation()"
             aria-label="ギフト詳細へ移動"></a>
          <% if gift_record.has_images? %>
            <%= gift_main_image_with_fallback(gift_record,
                  size: [400, 300],
                  css_class: "w-full h-full object-cover",
                  loading: "lazy") %>
          <% else %>
            <div class="gift-image-placeholder">
              <div class="text-center">
                <div class="w-16 h-16 sm:w-18 sm:h-18 lg:w-18 lg:h-18 xl:w-20 xl:h-20 mx-auto mb-2 sm:mb-3 bg-white rounded-full flex items-center justify-center shadow-sm">
                  <i class="fas fa-gift text-2xl sm:text-2xl lg:text-2xl xl:text-3xl text-primary"></i>
                </div>
                <p class="text-xs sm:text-sm text-gray-500">画像なし</p>
              </div>
            </div>
          <% end %>

          <div class="absolute top-2 left-2 sm:top-3 sm:left-3" onclick="event.stopPropagation();">
            <%= render 'shared/favorite_button', gift_record: gift_record %>
          </div>
        </div>
        
        <div class="p-4 sm:p-4 md:p-4 lg:p-5 xl:p-5 bg-white">
          <div class="mb-3">
            <h4 class="text-lg lg:text-xl xl:text-xl font-bold leading-tight text-gray-900 gift-title-clamp">
              <%= gift_record.display_item_name %>
            </h4>
          </div>

          <div class="flex justify-between items-center mb-3">
            <% if gift_record.amount.present? %>
              <div class="text-right">
                <span class="text-lg lg:text-xl xl:text-xl font-bold text-green-600">
                  <%= gift_record.display_amount %>
                </span>
              </div>
            <% end %>
          </div>

          <div class="mb-2">
            <div class="flex items-center text-sm">
              <i class="fas fa-calendar mr-2 text-blue-500"></i>
              <span class="text-gray-600">
                <%= truncate(gift_record.event&.name || "未設定", length: 20) %>
              </span>
            </div>
          </div>

          <div class="mb-3">
            <div class="flex items-center text-sm">
              <i class="fas fa-users mr-2 text-indigo-500"></i>
              <span class="text-gray-600">
                <%= truncate(gift_record.gift_person&.relationship&.name || "未設定", length: 15) %>
              </span>
            </div>
          </div>

          <% if gift_record.memo.present? %>
            <div class="mt-3 pt-3 border-t">
              <p class="text-xs leading-relaxed text-gray-500">
                <i class="fas fa-sticky-note mr-1 text-yellow-500"></i>
                <%= truncate(gift_record.memo, length: 60) %>
              </p>
            </div>
          <% end %>

          <div class="mt-3 pt-3 border-t">
            <div class="flex items-center">
              <% if gift_record.user.has_avatar? && display_avatar(gift_record.user, :small) %>
                <%= image_tag display_avatar(gift_record.user, :small),
                    class: "w-6 h-6 rounded-full object-cover mr-2",
                    alt: "#{gift_record.user.name}のプロフィール画像" %>
              <% else %>
                <div class="w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center mr-2">
                  <i class="fas fa-user text-gray-500 text-xs"></i>
                </div>
              <% end %>
              <div>
                <p class="text-xs font-medium text-gray-800">
                  <% if gift_record.user_id == current_user.id %>
                    あなたの記録
                  <% else %>
                    <%= gift_record.user&.display_name || "不明なユーザー" %>
                  <% end %>
                </p>
                <p class="text-xs text-gray-500">
                  お気に入り登録: <%= l(favorite.created_at, format: :short) %>
                </p>
              </div>
            </div>
          </div>
        </div>
        
      </div>
    <% end %>
  </div>
  <% if @favorites.respond_to?(:current_page) %>
    <%= render 'shared/pagination',
        collection: @favorites,
        page_path: ->(page_number) { favorites_path(@pagination_params.merge(page: page_number)) } %>
  <% end %>
<% else %>
  <%= render 'shared/empty_state',
      icon: 'fas fa-heart',
      title: 'まだお気に入りがありません',
      body: 'ギフト記録の詳細ページでハートマークをクリックすると、お気に入りに登録できます。',
      primary_action: {
        url: gift_records_path,
        icon: 'fas fa-gift',
        label: 'ギフト記録を探しに行く'
      }
    %>
<% end %>
</div>
