<%# encoding: utf-8 %>
<% content_for(:title, "お気に入り一覧") %>

<!-- メインコンテナ - 中央寄せ -->
<div class="max-w-6xl mx-auto">
<!-- ヘッダー部分 -->
<div class="mb-6 mt-4 text-center">
  <h2 class="text-2xl font-bold text-gray-800 mb-4">
    <i class="fas fa-heart mr-2 text-green-600"></i>
    お気に入り一覧
  </h2>
  
  <!-- ナビゲーション -->
  <div class="flex justify-center space-x-3">
    <%= link_to mypage_path,
        class: "inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary" do %>
      <i class="fas fa-arrow-left mr-2"></i>
      マイページに戻る
    <% end %>
    
    <%= link_to gift_records_path,
        class: "inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white btn-primary hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary" do %>
      <i class="fas fa-gift mr-2"></i>
      ギフト記録一覧
    <% end %>
  </div>
</div>

<!-- お気に入り統計 -->
<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6 max-w-2xl mx-auto">
  <div class="text-center">
    <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
      <i class="fas fa-heart text-2xl text-green-600"></i>
    </div>
    <h3 class="text-lg font-medium text-gray-800 mb-2">お気に入り登録数</h3>
    <p class="text-3xl font-bold text-green-600"><%= @favorites.length %>件</p>
    <p class="text-sm text-gray-600 mt-2">あなたがお気に入りに登録したギフト記録です</p>
  </div>
</div>

<!-- お気に入り一覧 -->
<% if @favorites.any? %>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
    <% @favorites.each do |favorite| %>
      <% gift_record = favorite.gift_record %>
      <% next unless gift_record.present? %>
      
      <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-200">
        <!-- カードヘッダー -->
        <div class="bg-gradient-to-r from-green-50 to-green-100 p-4 border-b border-green-200">
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <div class="w-10 h-10 bg-green-200 rounded-full flex items-center justify-center mr-3">
                <i class="fas fa-gift text-green-700"></i>
              </div>
              <div>
                <h3 class="font-semibold text-gray-800 text-sm"><%= gift_record.display_item_name %></h3>
                <p class="text-xs text-gray-600">
                  <i class="fas fa-calendar mr-1"></i>
                  <%= gift_record.display_gift_date %>
                </p>
              </div>
            </div>
            
            <!-- お気に入り削除ボタン -->
            <%= link_to gift_record_toggle_favorite_path(gift_record), 
                method: :post,
                data: { 
                  confirm: "お気に入りから削除しますか？",
                  turbo_method: :post
                },
                class: "inline-flex items-center justify-center w-8 h-8 rounded-full bg-red-100 hover:bg-red-200 transition-colors",
                title: "お気に入りから削除" do %>
              <i class="fas fa-heart-broken text-red-600 text-sm"></i>
            <% end %>
          </div>
        </div>
        
        <!-- カード本体 -->
        <div class="p-4">
          <!-- ギフト相手情報 -->
          <div class="mb-3">
            <div class="flex items-center text-sm text-gray-600 mb-1">
              <i class="fas fa-user mr-2 text-blue-500"></i>
              <span class="font-medium"><%= gift_record.gift_person&.name || "未設定" %></span>
            </div>
            <div class="flex items-center text-xs text-gray-500">
              <i class="fas fa-heart mr-2 text-pink-400"></i>
              <span><%= gift_record.gift_person&.relationship&.name || "未設定" %></span>
            </div>
          </div>
          
          <!-- イベント情報 -->
          <div class="mb-3">
            <div class="flex items-center text-sm text-gray-600">
              <i class="fas fa-star mr-2 text-yellow-500"></i>
              <span><%= gift_record.event&.name || "未設定" %></span>
            </div>
          </div>
          
          <!-- 金額情報 -->
          <div class="mb-3">
            <div class="flex items-center text-sm text-gray-600">
              <i class="fas fa-yen-sign mr-2 text-green-500"></i>
              <span class="font-semibold"><%= gift_record.display_amount %></span>
            </div>
          </div>
          
          <!-- メモ -->
          <% if gift_record.memo.present? %>
            <div class="mb-3">
              <div class="text-xs text-gray-500 mb-1">
                <i class="fas fa-sticky-note mr-1"></i>
                メモ
              </div>
              <div class="text-sm text-gray-700 bg-gray-50 rounded p-2">
                <%= truncate(gift_record.memo, length: 50) %>
              </div>
            </div>
          <% end %>
          
          <!-- 作成者情報 -->
          <div class="flex items-center justify-between text-xs text-gray-400 pt-2 border-t border-gray-100">
            <div class="flex items-center">
              <i class="fas fa-user-circle mr-1"></i>
              <span>
                <% if gift_record.user_id == current_user.id %>
                  あなたの記録
                <% else %>
                  <%= gift_record.user&.display_name || "不明なユーザー" %>
                <% end %>
              </span>
            </div>
            <div class="flex items-center">
              <i class="fas fa-heart mr-1 text-green-500"></i>
              <span><%= l(favorite.created_at, format: :short) %></span>
            </div>
          </div>
        </div>
        
        <!-- カードフッター -->
        <div class="px-4 py-3 bg-gray-50 border-t border-gray-200">
          <%= link_to gift_record_path(gift_record),
              class: "w-full inline-flex justify-center items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-primary hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors" do %>
            <i class="fas fa-eye mr-2"></i>
            詳細を見る
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <!-- 空の状態 -->
  <div class="text-center py-12 max-w-md mx-auto">
    <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
      <i class="fas fa-heart text-4xl text-gray-400"></i>
    </div>
    <h3 class="text-xl font-medium text-gray-800 mb-3">まだお気に入りがありません</h3>
    <p class="text-gray-600 mb-6">
      ギフト記録の詳細ページでハートマークをクリックすると、<br>
      お気に入りに登録できます。
    </p>
    
  </div>
<% end %>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // カードのホバー効果
  const cards = document.querySelectorAll('.bg-white.rounded-lg.shadow-md');
  
  cards.forEach(card => {
    card.addEventListener('mouseenter', function() {
      this.style.transform = 'translateY(-4px)';
      this.style.boxShadow = '0 10px 25px rgba(0, 0, 0, 0.15)';
      this.style.transition = 'all 0.3s ease';
    });
    
    card.addEventListener('mouseleave', function() {
      this.style.transform = 'translateY(0)';
      this.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
      this.style.transition = 'all 0.3s ease';
    });
  });
});
</script>
