<!-- ギフト相手詳細管理画面 -->
<div class="space-y-6">
  <!-- ページヘッダー -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">
        <i class="fas fa-user-friends mr-3 text-purple-600"></i>
        ギフト相手詳細
      </h1>
      <p class="text-gray-600 mt-1"><%= @gift_person.name %>さんの詳細情報と管理</p>
    </div>
    
    <!-- ナビゲーションボタン -->
    <div class="flex space-x-3">
      <%= link_to admin_gift_people_path,
          class: "inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500" do %>
        <i class="fas fa-arrow-left mr-2"></i>
        一覧に戻る
      <% end %>
    </div>
  </div>

  <!-- メイン情報カード -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- ギフト相手基本情報 -->
    <div class="lg:col-span-2 bg-white rounded-lg shadow-md overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-medium text-gray-900">基本情報</h3>
      </div>
      
      <div class="px-6 py-6">
        <div class="space-y-6">
          <!-- プロフィール情報 -->
          <div class="flex items-start space-x-4">
            <div class="flex-shrink-0">
              <% if @gift_person.has_avatar? %>
                <%= image_tag @gift_person.display_avatar(:large), 
                    class: "w-20 h-20 rounded-full object-cover border-4 border-purple-100" %>
              <% else %>
                <div class="w-20 h-20 rounded-full bg-purple-100 flex items-center justify-center border-4 border-purple-200">
                  <i class="fas fa-user text-3xl text-purple-600"></i>
                </div>
              <% end %>
            </div>
            <div class="flex-1">
              <h4 class="text-2xl font-bold text-gray-900 mb-2">
                <%= @gift_person.name %>
              </h4>
              <% if @gift_person.relationship %>
                <div class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-100 text-purple-800 mb-2">
                  <i class="fas fa-heart mr-1"></i>
                  <%= @gift_person.relationship.name %>
                </div>
              <% end %>
              
              <!-- 最新ギフト情報 -->
              <% if @person_statistics[:latest_gift_at] %>
                <div class="text-sm text-gray-500">
                  <i class="fas fa-gift mr-1"></i>
                  最新ギフト: <%= l(@person_statistics[:latest_gift_at], format: :short) %>
                </div>
              <% end %>
            </div>
          </div>

          <!-- 詳細情報グリッド -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pt-4 border-t border-gray-200">
            <div class="space-y-4">
              <!-- 誕生日 -->
              <% if @gift_person.birthday.present? %>
                <div>
                  <h5 class="text-sm font-medium text-gray-700 mb-1">誕生日</h5>
                  <div class="flex items-center text-gray-900">
                    <i class="fas fa-birthday-cake mr-2 text-pink-500"></i>
                    <%= l(@gift_person.birthday, format: :birthday) %>
                    <% if @gift_person.birthday.present? %>
                      <%# <span class="ml-2 text-sm text-gray-500">（<%= @gift_person.birthday.display_name %>
                       <span class="ml-2 text-sm text-gray-500">（<%= @gift_person.display_age_at %>)

                      </span> 
                    <% end %>
                  </div>
                </div>
              <% end %>

              <!-- 住所 -->
              <% if @gift_person.address.present? %>
                <div>
                  <h5 class="text-sm font-medium text-gray-700 mb-1">住所</h5>
                  <div class="flex items-start text-gray-900">
                    <i class="fas fa-map-marker-alt mr-2 text-red-500 mt-1"></i>
                    <span><%= @gift_person.address %></span>
                  </div>
                </div>
              <% end %>

              <!-- システム情報 -->
              <div>
                <h5 class="text-sm font-medium text-gray-700 mb-2">登録情報</h5>
                <div class="space-y-1 text-sm">
                  <div class="flex justify-between">
                    <span class="text-gray-500">ID:</span>
                    <span class="text-gray-900 font-mono">#<%= @gift_person.id %></span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-500">作成日:</span>
                    <span class="text-gray-900"><%= l(@gift_person.created_at, format: :short) %></span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-500">更新日:</span>
                    <span class="text-gray-900"><%= l(@gift_person.updated_at, format: :short) %></span>
                  </div>
                </div>
              </div>
            </div>

            <div class="space-y-4">
              <!-- 好きなもの -->
              <% if @gift_person.likes.present? %>
                <div>
                  <h5 class="text-sm font-medium text-gray-700 mb-1">好きなもの</h5>
                  <div class="bg-green-50 rounded-lg p-3">
                    <div class="flex items-start">
                      <i class="fas fa-thumbs-up mr-2 text-green-500 mt-1"></i>
                      <p class="text-gray-900 text-sm whitespace-pre-wrap"><%= @gift_person.likes %></p>
                    </div>
                  </div>
                </div>
              <% end %>

              <!-- 嫌いなもの -->
              <% if @gift_person.dislikes.present? %>
                <div>
                  <h5 class="text-sm font-medium text-gray-700 mb-1">嫌いなもの</h5>
                  <div class="bg-red-50 rounded-lg p-3">
                    <div class="flex items-start">
                      <i class="fas fa-thumbs-down mr-2 text-red-500 mt-1"></i>
                      <p class="text-gray-900 text-sm whitespace-pre-wrap"><%= @gift_person.dislikes %></p>
                    </div>
                  </div>
                </div>
              <% end %>

              <!-- メモ -->
              <% if @gift_person.memo.present? %>
                <div>
                  <h5 class="text-sm font-medium text-gray-700 mb-1">メモ</h5>
                  <div class="bg-gray-50 rounded-lg p-3">
                    <div class="flex items-start">
                      <i class="fas fa-sticky-note mr-2 text-yellow-500 mt-1"></i>
                      <p class="text-gray-900 text-sm whitespace-pre-wrap"><%= @gift_person.memo %></p>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 所有者情報と管理アクション -->
    <div class="space-y-6">
      <!-- 所有者情報 -->
      <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-lg font-medium text-gray-900">所有者情報</h3>
        </div>
        
        <div class="px-6 py-6">
          <div class="flex items-center space-x-4">
            <div class="flex-shrink-0">
              <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                <i class="fas fa-user text-xl text-blue-600"></i>
              </div>
            </div>
            <div class="flex-1">
              <h4 class="text-lg font-semibold text-gray-900">
                <%= link_to @gift_person.user.name, admin_user_path(@gift_person.user), 
                    class: "text-blue-600 hover:text-blue-800" %>
              </h4>
              <p class="text-gray-500 text-sm"><%= @gift_person.user.email %></p>
              <% if @gift_person.user.admin? %>
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800 mt-1">
                  <i class="fas fa-crown mr-1"></i>
                  管理者
                </span>
              <% end %>
            </div>
          </div>

          <!-- ユーザー詳細へのリンク -->
          <div class="mt-4">
            <%= link_to admin_user_path(@gift_person.user),
                class: "w-full inline-flex items-center justify-center px-3 py-2 border border-blue-300 rounded-md shadow-sm text-sm font-medium text-blue-700 bg-blue-50 hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" do %>
              <i class="fas fa-user mr-2"></i>
              ユーザー詳細を見る
            <% end %>
          </div>
        </div>
      </div>

      <!-- 管理アクション -->
      <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200">
          <h3 class="text-lg font-medium text-gray-900">管理アクション</h3>
        </div>
        
        <div class="px-6 py-6 space-y-3">
          <!-- 編集ボタン -->
          <%= link_to edit_admin_gift_person_path(@gift_person),
              class: "w-full inline-flex items-center justify-center px-4 py-3 border border-purple-300 rounded-md shadow-sm text-sm font-medium text-purple-700 bg-purple-50 hover:bg-purple-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500" do %>
            <i class="fas fa-edit mr-2"></i>
            基本情報を編集
          <% end %>

          <!-- 削除ボタン -->
          <button type="button"
                  data-action="click->delete-modal#show"
                  data-delete-url="<%= admin_gift_person_path(@gift_person) %>"
                  data-item-name="<%= @gift_person.name %>"
                  data-csrf-token="<%= form_authenticity_token %>"
                  class="w-full inline-flex items-center justify-center px-4 py-3 border border-red-300 rounded-md shadow-sm text-sm font-medium text-red-700 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
            <i class="fas fa-trash mr-2"></i>
            ギフト相手を削除
          </button>

          <!-- 警告メッセージ -->
          <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mt-4">
            <div class="text-sm text-yellow-800">
              <i class="fas fa-exclamation-triangle mr-1"></i>
              <strong>注意:</strong> 削除すると関連ギフト記録の相手情報もクリアされます。
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 統計情報 -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-purple-500">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <i class="fas fa-gift text-2xl text-purple-600"></i>
        </div>
        <div class="ml-5 w-0 flex-1">
          <dl>
            <dt class="text-sm font-medium text-gray-500 truncate">
              ギフト記録
            </dt>
            <dd class="text-2xl font-bold text-gray-900">
              <%= @person_statistics[:gift_records_count] %>件
            </dd>
          </dl>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <i class="fas fa-globe text-2xl text-green-600"></i>
        </div>
        <div class="ml-5 w-0 flex-1">
          <dl>
            <dt class="text-sm font-medium text-gray-500 truncate">
              公開記録
            </dt>
            <dd class="text-2xl font-bold text-gray-900">
              <%= @person_statistics[:public_gift_records_count] %>件
            </dd>
          </dl>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-red-500">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <i class="fas fa-heart text-2xl text-red-600"></i>
        </div>
        <div class="ml-5 w-0 flex-1">
          <dl>
            <dt class="text-sm font-medium text-gray-500 truncate">
              お気に入り
            </dt>
            <dd class="text-2xl font-bold text-gray-900">
              <%= @person_statistics[:total_favorites_count] %>件
            </dd>
          </dl>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <i class="fas fa-comment text-2xl text-blue-600"></i>
        </div>
        <div class="ml-5 w-0 flex-1">
          <dl>
            <dt class="text-sm font-medium text-gray-500 truncate">
              コメント
            </dt>
            <dd class="text-2xl font-bold text-gray-900">
              <%= @person_statistics[:total_comments_count] %>件
            </dd>
          </dl>
        </div>
      </div>
    </div>
  </div>

  <!-- 最近のギフト記録 -->
  <div class="bg-white rounded-lg shadow-md">
    <div class="px-6 py-4 border-b border-gray-200">
      <h3 class="text-lg font-medium text-gray-900">
        <i class="fas fa-history mr-2 text-gray-500"></i>
        最近のギフト記録
      </h3>
    </div>
    
    <div class="px-6 py-4">
      <% if @person_statistics[:recent_gift_records].any? %>
        <div class="space-y-4">
          <% @person_statistics[:recent_gift_records].each do |gift_record| %>
            <div class="flex items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
              <div class="flex-shrink-0">
                <% if gift_record.images.attached? && gift_record.images.first %>
                  <%= image_tag gift_record.images.first.variant(resize_to_fill: [48, 48, { gravity: "center" }]), 
                      class: "w-12 h-12 rounded-lg object-cover" %>
                <% else %>
                  <div class="w-12 h-12 rounded-lg bg-gray-300 flex items-center justify-center">
                    <i class="fas fa-gift text-gray-600"></i>
                  </div>
                <% end %>
              </div>
              
              <div class="ml-4 flex-1 min-w-0">
                <div class="flex items-center justify-between">
                  <h4 class="text-sm font-medium text-gray-900 truncate">
                    <%= link_to gift_record.display_item_name, admin_gift_record_path(gift_record), 
                        class: "text-purple-600 hover:text-purple-800" %>
                  </h4>
                  <div class="flex items-center space-x-2">
                    <% if gift_record.is_public? %>
                      <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                        公開
                      </span>
                    <% else %>
                      <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                        非公開
                      </span>
                    <% end %>
                  </div>
                </div>
                <div class="mt-1 flex items-center text-sm text-gray-500 space-x-4">
                  <span>
                    <i class="fas fa-user mr-1"></i>
                    <%= link_to gift_record.user.name, admin_user_path(gift_record.user), 
                        class: "text-blue-600 hover:text-blue-800" %>
                  </span>
                  <span>
                    <i class="fas fa-calendar mr-1"></i>
                    <%= gift_record.gift_at ? l(gift_record.gift_at, format: :short) : l(gift_record.created_at, format: :short) %>
                  </span>
                  <% if gift_record.gift_item_category %>
                    <span>
                      <i class="fas fa-tag mr-1"></i>
                      <%= gift_record.gift_item_category.name %>
                    </span>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>

        <!-- すべて見るリンク -->
        <% if @person_statistics[:gift_records_count] > 5 %>
          <div class="mt-4 text-center">
            <%= link_to admin_gift_records_path(gift_person_id: @gift_person.id),
                class: "inline-flex items-center px-4 py-2 border border-purple-300 rounded-md shadow-sm text-sm font-medium text-purple-700 bg-white hover:bg-purple-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500" do %>
              <i class="fas fa-list mr-2"></i>
              すべてのギフト記録を見る（<%= @person_statistics[:gift_records_count] %>件）
            <% end %>
          </div>
        <% end %>
      <% else %>
        <div class="text-center py-8">
          <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-gift text-2xl text-gray-400"></i>
          </div>
          <h4 class="text-lg font-medium text-gray-900 mb-2">ギフト記録がありません</h4>
          <p class="text-gray-500">この相手へのギフト記録はまだ登録されていません。</p>
        </div>
      <% end %>
    </div>
  </div>

  <!-- エンゲージメント分析 -->
  <% if @person_statistics[:gift_records_count] > 0 %>
    <div class="bg-white rounded-lg shadow-md p-6">
      <h3 class="text-lg font-medium text-gray-900 mb-4">
        <i class="fas fa-chart-line mr-2 text-gray-500"></i>
        エンゲージメント分析
      </h3>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div>
          <div class="text-sm text-gray-500 mb-2">公開率</div>
          <% public_rate = (@person_statistics[:public_gift_records_count].to_f / @person_statistics[:gift_records_count] * 100).round(1) %>
          <div class="flex items-center">
            <div class="flex-1 bg-gray-200 rounded-full h-3 mr-3">
              <div class="bg-green-500 h-3 rounded-full" style="width: <%= public_rate %>%"></div>
            </div>
            <span class="text-sm font-medium text-gray-900"><%= public_rate %>%</span>
          </div>
        </div>
        
        <div>
          <div class="text-sm text-gray-500 mb-2">記録当たり平均お気に入り</div>
          <% avg_favorites = (@person_statistics[:total_favorites_count].to_f / @person_statistics[:gift_records_count]).round(1) %>
          <div class="text-lg font-medium text-red-600">
            <%= avg_favorites %>件/記録
          </div>
        </div>
        
        <div>
          <div class="text-sm text-gray-500 mb-2">記録当たり平均コメント</div>
          <% avg_comments = (@person_statistics[:total_comments_count].to_f / @person_statistics[:gift_records_count]).round(1) %>
          <div class="text-lg font-medium text-blue-600">
            <%= avg_comments %>件/記録
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>
