<!-- 管理者ダッシュボード -->
<div class="space-y-6">
  <!-- ページヘッダー -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">
        <i class="fas fa-chart-line mr-3 text-blue-600"></i>
        管理者ダッシュボード
      </h1>
      <p class="text-gray-600 mt-1">システムの状況と最近の活動を確認できます</p>
    </div>
    <div class="text-sm text-gray-500">
      最終更新: <%= l(Time.current, format: :short) %>
    </div>
  </div>

  <!-- アラート情報 -->
  <% if @alerts.any? %>
    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
      <h3 class="text-lg font-medium text-yellow-800 mb-3">
        <i class="fas fa-exclamation-triangle mr-2"></i>
        要注意事項
      </h3>
      <div class="space-y-2">
        <% @alerts.each do |alert| %>
          <div class="flex items-center justify-between bg-white rounded p-3 border border-yellow-200">
            <span class="text-yellow-800"><%= alert[:message] %></span>
            <% if alert[:action_path] %>
              <%= link_to alert[:action_text], alert[:action_path], 
                  class: "text-blue-600 hover:text-blue-800 font-medium" %>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- システム統計カード -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    <!-- ユーザー統計 -->
    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">総ユーザー数</p>
          <p class="text-3xl font-bold text-gray-900"><%= @statistics[:total_users] %></p>
          <p class="text-sm text-gray-500 mt-1">
            管理者: <%= @statistics[:admin_users] %> / 
            一般: <%= @statistics[:general_users] %>
          </p>
        </div>
        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-users text-2xl text-blue-600"></i>
        </div>
      </div>
      <div class="mt-4 text-sm">
        <span class="text-green-600 font-medium">+<%= @statistics[:new_users_this_month] %></span>
        <span class="text-gray-500">今月の新規登録</span>
      </div>
    </div>

    <!-- ギフト記録統計 -->
    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-purple-500">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">総ギフト記録数</p>
          <p class="text-3xl font-bold text-gray-900"><%= @statistics[:total_gift_records] %></p>
          <p class="text-sm text-gray-500 mt-1">
            公開: <%= @statistics[:public_gift_records] %> / 
            非公開: <%= @statistics[:private_gift_records] %>
          </p>
        </div>
        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-gift text-2xl text-purple-600"></i>
        </div>
      </div>
      <div class="mt-4 text-sm">
        <span class="text-green-600 font-medium">+<%= @statistics[:gift_records_this_month] %></span>
        <span class="text-gray-500">今月の新規投稿</span>
      </div>
    </div>

    <!-- コメント統計 -->
    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">総コメント数</p>
          <p class="text-3xl font-bold text-gray-900"><%= @statistics[:total_comments] %></p>
        </div>
        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-comments text-2xl text-green-600"></i>
        </div>
      </div>
      <div class="mt-4 text-sm">
        <span class="text-green-600 font-medium">+<%= @statistics[:comments_this_month] %></span>
        <span class="text-gray-500">今月の新規コメント</span>
      </div>
    </div>

    <!-- その他統計 -->
    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-orange-500">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">その他データ</p>
          <div class="space-y-1 mt-2">
            <p class="text-sm text-gray-700">ギフト相手: <%= @statistics[:total_gift_people] %></p>
            <p class="text-sm text-gray-700">お気に入り: <%= @statistics[:total_favorites] %></p>
            <p class="text-sm text-gray-700">リマインダー: <%= @statistics[:total_reminds] %></p>
          </div>
        </div>
        <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-chart-bar text-2xl text-orange-600"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- 最近の活動 -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- 最近登録されたユーザー -->
    <div class="bg-white rounded-lg shadow-md">
      <div class="p-6 border-b border-gray-200">
        <h3 class="text-lg font-medium text-gray-900">
          <i class="fas fa-user-plus mr-2 text-blue-600"></i>
          最近のユーザー登録
        </h3>
      </div>
      <div class="p-6">
        <% if @recent_activities[:recent_users].any? %>
          <div class="space-y-3">
            <% @recent_activities[:recent_users].each do |user| %>
              <div class="flex items-center space-x-3">
                <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center">
                  <% if user.has_avatar? %>
                    <%= image_tag user.display_avatar(:small), 
                        class: "w-8 h-8 rounded-full object-cover" %>
                  <% else %>
                    <i class="fas fa-user text-gray-400 text-sm"></i>
                  <% end %>
                </div>
                <div class="flex-1 min-w-0">
                  <p class="text-sm font-medium text-gray-900 truncate">
                    <%= link_to user.name, admin_user_path(user), 
                        class: "hover:text-blue-600" %>
                  </p>
                  <p class="text-xs text-gray-500">
                    <%= l(user.created_at, format: :short) %>
                    <% if user.provider.present? %>
                      <span class="text-green-600">(LINE)</span>
                    <% end %>
                  </p>
                </div>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium 
                           <%= user.admin? ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800' %>">
                  <%= User.human_attribute_name("role.#{user.role}") %>
                </span>
              </div>
            <% end %>
          </div>
          <div class="mt-4">
            <%= link_to "すべてのユーザーを見る", admin_users_path, 
                class: "text-blue-600 hover:text-blue-800 text-sm font-medium" %>
          </div>
        <% else %>
          <p class="text-gray-500 text-sm">最近の登録はありません</p>
        <% end %>
      </div>
    </div>

    <!-- 最近のギフト記録 -->
    <div class="bg-white rounded-lg shadow-md">
      <div class="p-6 border-b border-gray-200">
        <h3 class="text-lg font-medium text-gray-900">
          <i class="fas fa-gift mr-2 text-purple-600"></i>
          最近のギフト記録
        </h3>
      </div>
      <div class="p-6">
        <% if @recent_activities[:recent_gift_records].any? %>
          <div class="space-y-3">
            <% @recent_activities[:recent_gift_records].each do |record| %>
              <div class="border-b border-gray-100 pb-3 last:border-b-0 last:pb-0">
                <p class="text-sm font-medium text-gray-900 truncate">
                  <%= link_to record.display_item_name, admin_gift_record_path(record), 
                      class: "hover:text-purple-600" %>
                </p>
                <p class="text-xs text-gray-500">
                  <%= record.user.name %> → <%= record.gift_person.name %>
                </p>
                <p class="text-xs text-gray-500">
                  <%= l(record.created_at, format: :short) %>
                  <span class="ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium 
                             <%= record.is_public? ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800' %>">
                    <%= record.is_public? ? '公開' : '非公開' %>
                  </span>
                </p>
              </div>
            <% end %>
          </div>
          <div class="mt-4">
            <%= link_to "すべてのギフト記録を見る", admin_gift_records_path, 
                class: "text-purple-600 hover:text-purple-800 text-sm font-medium" %>
          </div>
        <% else %>
          <p class="text-gray-500 text-sm">最近の投稿はありません</p>
        <% end %>
      </div>
    </div>

    <!-- 最近のコメント -->
    <div class="bg-white rounded-lg shadow-md">
      <div class="p-6 border-b border-gray-200">
        <h3 class="text-lg font-medium text-gray-900">
          <i class="fas fa-comments mr-2 text-green-600"></i>
          最近のコメント
        </h3>
      </div>
      <div class="p-6">
        <% if @recent_activities[:recent_comments].any? %>
          <div class="space-y-3">
            <% @recent_activities[:recent_comments].each do |comment| %>
              <div class="border-b border-gray-100 pb-3 last:border-b-0 last:pb-0">
                <p class="text-sm text-gray-900 line-clamp-2">
                  <%= link_to comment.excerpt(50), admin_comment_path(comment), 
                      class: "hover:text-green-600" %>
                </p>
                <p class="text-xs text-gray-500 mt-1">
                  <%= comment.user.name %> → 
                  <%= link_to comment.gift_record.display_item_name.truncate(20), 
                      admin_gift_record_path(comment.gift_record),
                      class: "hover:text-green-600" %>
                </p>
                <p class="text-xs text-gray-500">
                  <%= l(comment.created_at, format: :short) %>
                </p>
              </div>
            <% end %>
          </div>
          <div class="mt-4">
            <%= link_to "すべてのコメントを見る", admin_comments_path, 
                class: "text-green-600 hover:text-green-800 text-sm font-medium" %>
          </div>
        <% else %>
          <p class="text-gray-500 text-sm">最近のコメントはありません</p>
        <% end %>
      </div>
    </div>
  </div>

  <!-- クイックアクション -->
  <div class="bg-white rounded-lg shadow-md p-6">
    <h3 class="text-lg font-medium text-gray-900 mb-4">
      <i class="fas fa-bolt mr-2 text-yellow-600"></i>
      クイックアクション
    </h3>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <%= link_to admin_users_path, 
          class: "flex items-center justify-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors" do %>
        <div class="text-center">
          <i class="fas fa-users text-2xl text-blue-600 mb-2"></i>
          <p class="text-sm font-medium text-gray-900">ユーザー管理</p>
        </div>
      <% end %>

      <%= link_to admin_gift_records_path, 
          class: "flex items-center justify-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors" do %>
        <div class="text-center">
          <i class="fas fa-gift text-2xl text-purple-600 mb-2"></i>
          <p class="text-sm font-medium text-gray-900">ギフト記録</p>
        </div>
      <% end %>

      <%= link_to admin_comments_path, 
          class: "flex items-center justify-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors" do %>
        <div class="text-center">
          <i class="fas fa-comments text-2xl text-green-600 mb-2"></i>
          <p class="text-sm font-medium text-gray-900">コメント管理</p>
        </div>
      <% end %>

      <%= link_to admin_statistics_path, 
          class: "flex items-center justify-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors" do %>
        <div class="text-center">
          <i class="fas fa-chart-bar text-2xl text-orange-600 mb-2"></i>
          <p class="text-sm font-medium text-gray-900">統計情報</p>
        </div>
      <% end %>
    </div>
  </div>
</div>