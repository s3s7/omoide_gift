<% content_for(:title, "マイギフト記録一覧") %>
<!-- メインコンテナ - 中央寄せ -->
<div class="max-w-6xl mx-auto">
  <!-- ヘッダー部分 -->
  <div class="mb-2 mt-2 text-center">
    <h2 class="text-2xl font-bold text-gray-800 mb-3">
      じぶんのギフト
    </h2>
  </div>

  <!-- 統計情報 -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4 max-w-4xl mx-auto">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
      <div>
        <div class="text-2xl font-bold text-primary"><%= @total_records %></div>
        <div class="text-sm text-gray-600">総記録数</div>
      </div>
      <div>
        <div class="text-2xl font-bold text-green-600"><%= @public_records_count %></div>
        <div class="text-sm text-gray-600">公開記録</div>
      </div>
      <div>
        <div class="text-2xl font-bold text-gray-600"><%= @private_records_count %></div>
        <div class="text-sm text-gray-600">非公開記録</div>
      </div>
      <div>
        <div class="text-2xl font-bold text-blue-600"><%= @current_month_records %></div>
        <div class="text-sm text-gray-600">今月の記録</div>
      </div>
    </div>
  </div>

  <!-- 検索・フィルター機能 -->
  <%= render 'shared/filter_form',
      form_url: my_index_gift_records_path,
      relationship_options: @relationship_options,
      event_options: @event_options,
      gift_people_options: @gift_people_options,
      public_filter_options: [
        ["すべて", ""],
        ["公開", "public"],
        ["非公開", "private"]
      ],
      filter_type_options: [
        ["選択してください", ""],
        ["ギフト相手", "gift_person"],
        ["関係性", "relationship"],
        ["イベント", "event"],
        ["公開設定", "is_public"]
      ],
      search_placeholder: "アイテム名、メモ、相手名で検索",
      total_records: @total_records,
      active_filter_params: [:search, :gift_person_id, :relationship_id, :event_id, :sort_by, :is_public]
    %>

  <!-- ギフト記録一覧 -->
  <div class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 xl:grid-cols-5 gap-2 md:gap-3 lg:gap-4 justify-items-center mb-6">
    <% if @gift_records.any? %>
      <% @gift_records.each do |gift_record| %>
        <div class="bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden hover:shadow-lg transition-shadow gift-card-container w-[165px] sm:w-[165px] md:w-[240px] lg:w-[200px] xl:w-[200px]">
          <!-- 画像部分 -->
          <div class="aspect-w-16 aspect-h-9 bg-gray-100">
            <% if gift_record.images.any? %>
              <%= image_tag gift_record.images.first,
                  class: "w-full h-48 object-cover",
                  alt: gift_record.item_name %>
            <% else %>
              <div class="w-full h-48 bg-gray-100 flex items-center justify-center">
                <i class="fas fa-gift text-4xl text-gray-400"></i>
              </div>
            <% end %>
          </div>

          <!-- コンテンツ部分 -->
          <div class="p-4">
            <!-- 公開/非公開ステータス -->
            <div class="flex items-center justify-between mb-2">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= gift_record.is_public? ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800' %>">
                <i class="<%= gift_record.is_public? ? 'fas fa-globe' : 'fas fa-lock' %> mr-1"></i>
                <%= gift_record.is_public? ? '公開' : '非公開' %>
              </span>
              <span class="text-xs text-gray-500">
                <%= l(gift_record.gift_at, format: :short) %>
              </span>
            </div>

            <!-- アイテム名 -->
            <h3 class="text-lg font-semibold text-gray-900 mb-2 truncate">
              <%= gift_record.item_name %>
            </h3>

            <!-- ギフト相手と関係性 -->
            <div class="flex items-center text-sm text-gray-600 mb-2">
              <i class="fas fa-user mr-1"></i>
              <%= gift_record.gift_person.name %>
              <% if gift_record.gift_person.relationship %>
                <span class="mx-1">·</span>
                <%= gift_record.gift_person.relationship.name %>
              <% end %>
            </div>

            <!-- イベント -->
            <% if gift_record.event %>
              <div class="flex items-center text-sm text-gray-600 mb-3">
                <i class="fas fa-calendar mr-1"></i>
                <%= gift_record.event.name %>
              </div>
            <% end %>

            <!-- アクションボタン -->
            <div class="flex space-x-2">
              <%= link_to gift_record_path(gift_record, @pagination_params.merge(page: params[:page], origin: 'my')),
                  class: "flex-1 text-center bg-blue-500 text-white px-3 py-2 text-sm rounded-md hover:bg-blue-600 focus:outline-none" do %>
                <i class="fas fa-eye mr-1"></i>
                詳細
              <% end %>
              <% edit_params = (@pagination_params || {}).merge(page: params[:page], origin: 'my') %>
              <%= link_to edit_gift_record_path(gift_record, edit_params),
                  class: "flex-1 text-center bg-green-500 text-white px-3 py-2 text-sm rounded-md hover:bg-green-600 focus:outline-none" do %>
                <i class="fas fa-edit mr-1"></i>
                編集
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <div class="gift-card-container col-span-full flex justify-center">
        <div class="w-[165px] sm:w-[165px] md:w-[240px] lg:w-[200px] xl:w-[200px]">
          <%= render 'shared/empty_state',
              icon: 'fas fa-gift',
              title: 'まだギフト記録がありません',
              body: '最初のギフト記録を作成してみましょう！',
              primary_action: {
                url: new_gift_record_path,
                icon: 'fas fa-plus',
                label: 'ギフト記録を作成',
                class: 'inline-flex items-center px-3 py-1.5 border border-transparent rounded-md shadow-sm text-xs font-medium text-white bg-primary hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary'
              }
            %>
        </div>
      </div>
    <% end %>
  </div>

  <% if @gift_records.any? && @gift_records.respond_to?(:current_page) %>
    <%= render 'shared/pagination',
        collection: @gift_records,
        page_path: ->(page_number) { my_index_gift_records_path(@pagination_params.merge(page: page_number)) } %>
  <% end %>
</div>
