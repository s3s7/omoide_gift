<% content_for(:title, "記念日を設定") %>

<!-- メインコンテナ -->
<div class="max-w-2xl mx-auto">
  <!-- ヘッダー部分 -->
  <div class="mb-6 mt-4 text-center">
    <h2 class="text-2xl font-bold text-gray-800 mb-3">
      記念日を設定
    </h2>
    <p class="text-sm text-gray-800">
      大切な人の記念日を設定して、LINEで通知を受け取りましょう
    </p>
  </div>

  <!-- フォーム -->
  <%= render "form",
      remind: @remind,
      gift_people: @gift_people,
      mode: :new,
      back_path: reminds_path,
      submit_label: "記念日を設定" %>

  <!-- 既存の記念日がある場合の一覧 -->
  <% if current_user.reminds.any? %>
    <div class="mt-8 bg-white rounded-lg shadow-md border border-gray-200 p-6">
      <h3 class="text-lg font-medium text-gray-800 mb-4">
        <i class="fas fa-list mr-2 text-gray-600"></i>
        設定済みの記念日
      </h3>
      
      <div class="space-y-3">
        <% current_user.reminds.includes(gift_person: :relationship).order(:notification_at).limit(5).each do |remind| %>
          <div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
            <div class="flex-1">
              <h4 class="font-medium text-gray-800"><%= remind.gift_person.name %>さん</h4>
              <div class="text-sm text-gray-600">
                <span class="mr-3">
                  <i class="fas fa-heart mr-1"></i>
                  <%= remind.gift_person.relationship&.name || "未設定" %>
                </span>
                <span>
                  <i class="fas fa-calendar mr-1"></i>
                  <%= l(remind.notification_at, format: :short) %>
                </span>
              </div>
            </div>
            <div class="text-right">
              <% if remind.is_sent? %>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  <i class="fas fa-check mr-1"></i>
                  送信済み
                </span>
              <% else %>
                <% days_left = remind.days_until_notification %>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium <%= days_left <= 3 ? 'bg-red-100 text-red-800' : 'bg-orange-100 text-orange-800' %>">
                  <i class="fas fa-clock mr-1"></i>
                  <% if days_left == 0 %>
                    今日
                  <% elsif days_left == 1 %>
                    明日
                  <% else %>
                    あと<%= days_left %>日
                  <% end %>
                </span>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
      
      <% if current_user.reminds.count > 5 %>
        <div class="mt-4 text-center">
          <%= link_to reminds_path, class: "text-sm text-orange-600 hover:text-orange-700 font-medium" do %>
            すべて見る（<%= current_user.reminds.count %>件）→
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
